import{h as R,aG as W,aH as z,k as $,m as A,p as M,z as t,q as C,N as E,G as F,I,J as N,H as G,R as Y,aI as X,aa as J,l as n,d as D,b as H,o as v,i as L,a9 as U,aq as Z,s as j,F as K}from"./index.CHlnk_G5.js";import{_ as O}from"./chunk.FormBox.vue_vue_type_style_index_0_lang.CQC_RdrO.js";import{_ as Q}from"./chunk.FormField.vue_vue_type_style_index_0_lang.DBA7iGDy.js";import{s as ee}from"./chunk.index.DF7CplV7.js";import{H as te}from"./chunk.http.D1AbaxGe.js";import{B as se}from"./chunk.BaseResponse.BOfAc7uK.js";import{B as oe}from"./chunk.BaseModel.BJiNiVpj.js";import"./chunk.index.CPFFhiYL.js";import"./chunk.index.Ck9JIKbF.js";import"./chunk.index.BYK99MpJ.js";const ae={class:"relative bg-slate-200 rounded-xl overflow-hidden select-none"},ne={class:"absolute right-3 top-3 z-10 flex flex-col gap-2"},re=["transform"],le=["transform"],ie=["textContent"],ue=["cx","onClick"],de=R({__name:"SelectSeatPlan",props:W({seats:{},disabledSeats:{default:()=>[]}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(p){const r=p,d=z(p,"modelValue"),b=()=>{const s=o=>{e(o)&&(d.value=n.xor(d.value,[o.id]))},e=o=>!n.some(r.disabledSeats,a=>n.isEqual(a.id,o.id));return{toggleSeat:s,isSeatAvailable:e}},x=()=>{const s=D(1),e=D({x:0,y:0}),o=D(!1),l=D({x:0,y:0}),a=i=>{i.preventDefault();const T=i.deltaY>0?-.3:.3;s.value=Math.min(Math.max(.5,s.value+T),2.5)},y=i=>{o.value=!0,l.value={x:i.clientX-e.value.x,y:i.clientY-e.value.y}},V=n.throttle(i=>{o.value&&(e.value={x:i.clientX-l.value.x,y:i.clientY-l.value.y})},16),m=()=>{o.value=!1},q=H(()=>`translate(${e.value.x} ${e.value.y}) scale(${s.value})`);return{scale:s,offset:e,transform:q,isPanning:o,onWheel:a,startDrag:y,onDrag:V,endDrag:m}},B=s=>({rows:H(()=>s.reduce((o,l)=>(n.has(o,l.row)||n.set(o,l.row,[]),n.get(o,l.row).push(l),o),{}))}),{toggleSeat:w,isSeatAvailable:S}=b(),{scale:g,transform:h,isPanning:c,onWheel:u,startDrag:f,onDrag:k,endDrag:_}=x(),{rows:P}=B(r.seats);return(s,e)=>{const o=ee,l=X;return v(),$("div",ae,[A("div",ne,[M(o,{severity:"secondary",onClick:e[0]||(e[0]=a=>g.value=Math.min(t(g)+.3,2.5))},{default:C(()=>[...e[7]||(e[7]=[E(" ＋ ",-1)])]),_:1}),M(o,{severity:"secondary",onClick:e[1]||(e[1]=a=>g.value=Math.max(t(g)-.3,.5))},{default:C(()=>[...e[8]||(e[8]=[E(" － ",-1)])]),_:1})]),(v(),$("svg",{width:"100%",height:"350",onWheel:e[2]||(e[2]=(...a)=>t(u)&&t(u)(...a)),onMousedown:e[3]||(e[3]=(...a)=>t(f)&&t(f)(...a)),onMousemove:e[4]||(e[4]=(...a)=>t(k)&&t(k)(...a)),onMouseup:e[5]||(e[5]=(...a)=>t(_)&&t(_)(...a)),onMouseleave:e[6]||(e[6]=(...a)=>t(_)&&t(_)(...a)),class:F({"cursor-grab":!t(c),"cursor-grabbing":t(c)})},[A("g",{transform:t(h)},[(v(!0),$(I,null,N(t(P),(a,y,V)=>(v(),$("g",{key:y,transform:`translate(80, ${V*50+50})`},[A("text",{x:"-40",y:"6",class:"fill-slate-500 text-sm",textContent:G(y)},null,8,ie),(v(!0),$(I,null,N(a,(m,q)=>Y((v(),$("circle",{key:m.id,cx:q*35,cy:"0",r:"12",class:F(["cursor-pointer transition-all",{"fill-slate-300 cursor-not-allowed":!t(S)(m),"fill-white stroke-slate-400 hover:fill-blue-200":t(S)(m),"!fill-blue-500":("_find"in s?s._find:t(n.find))(d.value,i=>("_isEqual"in s?s._isEqual:t(n.isEqual))(i,m.id))}]),onClick:J(i=>t(w)(m),["stop"])},null,10,ue)),[[l,`${s.$t("events.event_seat.seat")}: ${y}${m.seat}
                     ${t(S)(m)?s.$t("events.event_seat.empty"):s.$t("events.event_seat.sold_out/not_avaliable")}`]])),128))],8,le))),128))],8,re)],34))])}}});class me extends te{list(r,d,...b){return super.get(`seat-plans/${r}/${d}`,...b)}}const ce=new me;class fe extends oe{static create(...r){return new this(...r)}}const he=R({__name:"index",props:{event:{}},async setup(p){let r,d;const b=p,x=L(),B=n.toNumber(x.params.eventId),w=n.toNumber(x.params.eventCategoryId),S=n.find(b.event.event_categories,({id:u})=>n.isEqual(u,w)),g=([r,d]=U(()=>ce.list(B,w)),r=await r,d(),r),h=se.create()._merge(g)._map(fe),c=Z().getters.checkoutForm;return(u,f)=>{const k=de,_=Q,P=O;return v(),j(P,{form:t(c),onSubmit:f[1]||(f[1]=s=>t(c)._validate(["seats"])&&u.$router.push({name:"event-checkout"})),submitText:u.$t("events.event.go_to_checkout")},{default:C(()=>[M(_,{label:`${u.$t("fields.seats")} - ${t(S).name}`,class:"w-full",fluid:"",error:t(c)._errors.first("seats")},{default:C(s=>[M(k,K(s,{modelValue:t(c)._data.seats,"onUpdate:modelValue":f[0]||(f[0]=e=>t(c)._data.seats=e),seats:t(h)._data,disabledSeats:("_filter"in u?u._filter:t(n.filter))(t(h)._data,e=>e.isBooked)}),null,16,["modelValue","seats","disabledSeats"])]),_:1},8,["label","error"])]),_:1},8,["form","submitText"])}}});export{he as default};
